@model Umbraco13.Models.TableData

<div id="funds-table-container" style="margin: 40px auto 0 auto; width: 70%; max-width: 100%;">
    <!-- Download Buttons -->
    <div style="margin-bottom: 15px; text-align: right;">
        <a href="/funds/exporttocsv" class="btn btn-primary" style="text-decoration: none; margin-right: 10px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-csv" viewBox="0 0 16 16" style="margin-right: 5px; vertical-align: text-bottom;">
                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
            </svg>
            Download CSV
        </a>
        <a href="/funds/exporttoexcel" class="btn btn-success" style="text-decoration: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-excel" viewBox="0 0 16 16" style="margin-right: 5px; vertical-align: text-bottom;">
                <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.78l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.22 5.884 6.68z"/>
                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
            </svg>
            Download Excel
        </a>
    </div>

    @if (Model != null && Model.Cells != null && Model.Cells.Count > 0)
    {
        <div class="table-responsive">
            <table class="@Model.TableClass">
            <thead>
                @{
                    var firstRow = Model.Cells.FirstOrDefault();
                    if (firstRow != null && firstRow.Any(c => c.Type == Umbraco13.Models.TableCellType.Th))
                    {
                        <tr class="table-light">
                            @foreach (var cell in firstRow)
                            {
                                if (cell.Type == Umbraco13.Models.TableCellType.Th)
                                {
                                    <th class="@(cell.CssClass ?? "text-center")" scope="@(cell.Scope ?? "col")">@cell.Value</th>
                                }
                            }
                        </tr>
                    }
                }
            </thead>
            <tbody>
                @foreach (var row in Model.Cells)
                {
                    // Skip header row (rows with TH cells in first position)
                    if (row.FirstOrDefault()?.Type != Umbraco13.Models.TableCellType.Th)
                    {
                        <tr>
                            @foreach (var cell in row)
                            {
                                <td class="@(cell.CssClass ?? "text-center")">@cell.Value</td>
                            }
                        </tr>
                    }
                }
            </tbody>
            </table>
        </div>
    }
    else
    {
        <p>No funds data available.</p>
    }
</div>

<script>
    // Function to reload the funds table
    function reloadFundsTable() {
        fetch('/funds/update-table')
            .then(response => response.text())
            .then(html => {
                document.getElementById('funds-table-container').innerHTML = html;
            })
            .catch(error => console.error('Error reloading funds table:', error));
    }

    // Reload every 20 minutes (20 * 60 * 1000 ms)
    setInterval(reloadFundsTable, 20 * 60 * 1000);
</script>
